<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Music Library Deduplicator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #FF0000, #FF4444);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            color: #FF0000;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .auth-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }
        
        .auth-status {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #dc3545;
        }
        
        .status-indicator.connected {
            background: #28a745;
        }
        
        .auth-instructions {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
            font-size: 0.9em;
        }
        
        .controls {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .status-item {
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 10px;
            text-align: center;
            flex: 1;
            min-width: 150px;
        }
        
        .status-number {
            font-size: 1.8em;
            font-weight: bold;
            color: #FF0000;
        }
        
        .status-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .scan-button {
            background: #FF0000;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s ease;
            margin-right: 15px;
        }
        
        .scan-button:hover:not(:disabled) {
            background: #CC0000;
        }
        
        .scan-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF0000, #FF4444);
            transition: width 0.5s ease;
            border-radius: 10px;
            width: 0%;
        }
        
        .duplicates-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }
        
        .duplicate-group {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
            transition: border-color 0.3s ease;
        }
        
        .duplicate-group.selected {
            border-color: #FF0000;
        }
        
        .group-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        .group-title {
            flex: 1;
        }
        
        .song-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }
        
        .song-artist {
            color: #666;
            margin-top: 5px;
        }
        
        .duplicate-count {
            background: #FF0000;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .group-checkbox {
            margin-right: 10px;
        }
        
        .duplicates-list {
            padding: 0;
        }
        
        .duplicate-item {
            padding: 15px 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            transition: background 0.2s ease;
        }
        
        .duplicate-item:hover {
            background: #f8f9fa;
        }
        
        .duplicate-item:last-child {
            border-bottom: none;
        }
        
        .item-info {
            flex: 1;
            margin-left: 15px;
        }
        
        .item-title {
            font-weight: 600;
            color: #333;
        }
        
        .item-details {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .item-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .keep-button, .remove-button {
            padding: 5px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .keep-button {
            background: #28a745;
            color: white;
        }
        
        .keep-button:hover {
            background: #218838;
        }
        
        .remove-button {
            background: #dc3545;
            color: white;
        }
        
        .remove-button:hover {
            background: #c82333;
        }
        
        .quality-badge {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .quality-high {
            background: #d4edda;
            color: #155724;
        }
        
        .quality-medium {
            background: #fff3cd;
            color: #856404;
        }
        
        .quality-low {
            background: #f8d7da;
            color: #721c24;
        }
        
        .bottom-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }
        
        .action-button {
            background: #FF0000;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .action-button:hover:not(:disabled) {
            background: #CC0000;
        }
        
        .action-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .action-button.secondary {
            background: #6c757d;
        }
        
        .action-button.secondary:hover:not(:disabled) {
            background: #5a6268;
        }
        
        .hidden {
            display: none;
        }
        
        .log-area {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #f5c6cb;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #c3e6cb;
        }
        
        @media (max-width: 768px) {
            .status-bar {
                flex-direction: column;
            }
            
            .status-item {
                min-width: 100%;
            }
            
            .duplicate-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .item-actions {
                margin-top: 10px;
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üóÇÔ∏è YouTube Music Library Deduplicator</h1>
            <p>Find and manage duplicate songs in your YouTube Music library</p>
        </div>
        
        <div class="auth-section">
            <div class="auth-status">
                <div class="status-indicator" id="authIndicator"></div>
                <span id="authStatus">Checking authentication...</span>
                <button class="scan-button" id="authButton" onclick="checkAuth()" style="padding: 8px 16px; font-size: 0.9em;">
                    üîÑ Check Auth
                </button>
            </div>
            
            <div class="auth-instructions hidden" id="authInstructions">
                <h4>üìã Authentication Setup Required</h4>
                <ol style="margin: 10px 0; padding-left: 20px;">
                    <li>Open YouTube Music in your browser</li>
                    <li>Open Developer Tools (F12)</li>
                    <li>Go to Network tab and refresh the page</li>
                    <li>Find a request to 'music.youtube.com/youtubei/v1/'</li>
                    <li>Right-click ‚Üí Copy ‚Üí Copy request headers</li>
                    <li>Create <code>headers_auth.json</code> file with the copied headers</li>
                    <li>Restart the server</li>
                </ol>
                <p><strong>Note:</strong> The server needs to be restarted after adding the auth file.</p>
            </div>
        </div>
        
        <div class="controls">
            <div class="status-bar">
                <div class="status-item">
                    <div class="status-number" id="totalSongs">--</div>
                    <div class="status-label">Total Library Songs</div>
                </div>
                <div class="status-item">
                    <div class="status-number" id="duplicateGroups">--</div>
                    <div class="status-label">Duplicate Groups</div>
                </div>
                <div class="status-item">
                    <div class="status-number" id="totalDuplicates">--</div>
                    <div class="status-label">Total Duplicates</div>
                </div>
                <div class="status-item">
                    <div class="status-number" id="canRemove">--</div>
                    <div class="status-label">Can Be Removed</div>
                </div>
            </div>
            
            <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                <button class="scan-button" id="scanButton" onclick="startScan()" disabled>
                    üîç Scan Library for Duplicates
                </button>
                <button class="scan-button" id="selectAllButton" onclick="selectAllGroups()" style="background: #6c757d;" disabled>
                    ‚úÖ Select All Groups
                </button>
                <button class="scan-button" id="createPlaylistButton" onclick="createDuplicatesPlaylist()" style="background: #28a745;" disabled>
                    üéµ Create Duplicates Playlist
                </button>
            </div>
            
            <div class="progress-bar hidden" id="progressBar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div class="log-area hidden" id="logArea"></div>
        </div>
        
        <div class="duplicates-container hidden" id="duplicatesContainer">
            <h2 style="margin-bottom: 20px; color: #333;">Duplicate Groups Found</h2>
            <div id="duplicatesList"></div>
            
            <div class="bottom-actions">
                <button class="action-button secondary" onclick="exportResults()">
                    üìÑ Export Results
                </button>
                <button class="action-button" onclick="createSelectedPlaylist()" disabled id="createSelectedButton">
                    üéµ Create Playlist with Selected
                </button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5003/api';
        
        let libraryData = [];
        let duplicateGroups = [];
        let selectedGroups = new Set();
        let isAuthenticated = false;
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            checkStatus();
            loadExistingResults();
        });
        
        async function checkStatus() {
            try {
                const response = await fetch(`${API_BASE}/status`);
                const data = await response.json();
                
                isAuthenticated = data.authenticated;
                updateAuthStatus(isAuthenticated);
                
                if (data.library_count > 0) {
                    document.getElementById('totalSongs').textContent = data.library_count.toLocaleString();
                }
                
                if (data.duplicate_groups > 0) {
                    document.getElementById('duplicateGroups').textContent = data.duplicate_groups;
                }
                
            } catch (error) {
                log('‚ùå Failed to connect to server. Make sure the backend is running.');
                updateAuthStatus(false);
                showError('Cannot connect to backend server. Please start the Python server first.');
            }
        }
        
        function updateAuthStatus(authenticated) {
            const indicator = document.getElementById('authIndicator');
            const status = document.getElementById('authStatus');
            const scanButton = document.getElementById('scanButton');
            const instructions = document.getElementById('authInstructions');
            
            if (authenticated) {
                indicator.classList.add('connected');
                status.textContent = 'Connected to YouTube Music';
                scanButton.disabled = false;
                instructions.classList.add('hidden');
            } else {
                indicator.classList.remove('connected');
                status.textContent = 'Not authenticated';
                scanButton.disabled = true;
                instructions.classList.remove('hidden');
            }
            
            isAuthenticated = authenticated;
        }
        
        async function checkAuth() {
            try {
                const response = await fetch(`${API_BASE}/authenticate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    log('‚úÖ Authentication successful');
                    updateAuthStatus(true);
                    showSuccess('Successfully connected to YouTube Music!');
                } else {
                    log('‚ùå Authentication failed: ' + data.error);
                    updateAuthStatus(false);
                    showError('Authentication failed: ' + data.error);
                }
            } catch (error) {
                log('‚ùå Auth check failed: ' + error.message);
                showError('Failed to check authentication: ' + error.message);
            }
        }
        
        async function startScan() {
            if (!isAuthenticated) {
                showError('Please authenticate first');
                return;
            }
            
            const scanButton = document.getElementById('scanButton');
            const progressBar = document.getElementById('progressBar');
            const logArea = document.getElementById('logArea');
            
            scanButton.disabled = true;
            scanButton.textContent = 'üîÑ Scanning...';
            progressBar.classList.remove('hidden');
            logArea.classList.remove('hidden');
            
            log('üîç Starting library scan...');
            log('üìö Connecting to YouTube Music API...');
            
            try {
                updateProgress(10);
                log('üì± Getting library songs...');
                
                const response = await fetch(`${API_BASE}/scan`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        similarity_threshold: 0.85
                    })
                });
                
                updateProgress(50);
                log('üîç Analyzing for duplicates...');
                
                const data = await response.json();
                
                updateProgress(80);
                log('üßπ Organizing results...');
                
                if (data.success) {
                    duplicateGroups = data.groups;
                    updateStats(data);
                    displayDuplicates();
                    
                    updateProgress(100);
                    log('‚úÖ Scan complete!');
                    log(`üéØ Found ${data.duplicate_groups} duplicate groups`);
                    log(`üßπ You can remove ${data.can_remove} duplicate songs`);
                    
                    scanButton.textContent = '‚úÖ Scan Complete';
                    document.getElementById('selectAllButton').disabled = false;
                    document.getElementById('createPlaylistButton').disabled = false;
                    
                    if (data.duplicate_groups > 0) {
                        showSuccess(`Found ${data.duplicate_groups} groups of duplicates! You can remove ${data.can_remove} songs.`);
                    } else {
                        showSuccess('No duplicates found in your library!');
                    }
                } else {
                    throw new Error(data.error);
                }
                
            } catch (error) {
                log('‚ùå Scan failed: ' + error.message);
                showError('Scan failed: ' + error.message);
                scanButton.textContent = 'üîç Scan Library for Duplicates';
                scanButton.disabled = false;
            }
        }
        
        async function loadExistingResults() {
            try {
                const response = await fetch(`${API_BASE}/export`);
                if (response.ok) {
                    const data = await response.json();
                    console.log('Export data:', data); // Debug log
                    if (data.duplicate_groups > 0) {
                        duplicateGroups = data.groups;
                        updateStats(data);
                        displayDuplicates();
                        
                        // Enable buttons
                        const selectBtn = document.getElementById('selectAllButton');
                        const playlistBtn = document.getElementById('createPlaylistButton');
                        if (selectBtn) selectBtn.disabled = false;
                        if (playlistBtn) playlistBtn.disabled = false;
                        
                        log(`üìä Loaded existing scan results: ${data.duplicate_groups} groups found`);
                        console.log('Buttons enabled, duplicateGroups length:', duplicateGroups.length);
                    }
                } else {
                    console.log('Export API response not ok:', response.status);
                }
            } catch (error) {
                console.log('Error loading existing results:', error);
            }
        }
        
        function updateStats(data) {
            // Handle different field names between scan and export APIs
            const totalSongs = data.total_songs || data.total_library_songs;
            if (totalSongs) {
                document.getElementById('totalSongs').textContent = totalSongs.toLocaleString();
            }
            document.getElementById('duplicateGroups').textContent = data.duplicate_groups;
            document.getElementById('totalDuplicates').textContent = data.total_duplicates;
            document.getElementById('canRemove').textContent = data.can_remove;
        }
        
        function displayDuplicates() {
            const container = document.getElementById('duplicatesContainer');
            const list = document.getElementById('duplicatesList');
            
            list.innerHTML = '';
            
            if (duplicateGroups.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">No duplicates found! Your library is clean.</p>';
            } else {
                duplicateGroups.forEach(group => {
                    const groupElement = createDuplicateGroupElement(group);
                    list.appendChild(groupElement);
                });
            }
            
            container.classList.remove('hidden');
        }
        
        function createDuplicateGroupElement(group) {
            const div = document.createElement('div');
            div.className = 'duplicate-group';
            div.dataset.groupId = group.id;
            
            div.innerHTML = `
                <div class="group-header" onclick="toggleGroup(${group.id})">
                    <input type="checkbox" class="group-checkbox" onchange="toggleGroupSelection(${group.id})" onclick="event.stopPropagation()">
                    <div class="group-title">
                        <div class="song-title">${escapeHtml(group.title)}</div>
                        <div class="song-artist">${escapeHtml(group.artist)}</div>
                    </div>
                    <div class="duplicate-count">${group.duplicates.length} copies</div>
                    <div style="font-size: 0.8em; color: #666;">‚ñº</div>
                </div>
                <div class="duplicates-list" style="display: none;">
                    ${group.duplicates.map((dup, index) => `
                        <div class="duplicate-item">
                            <input type="radio" name="keep-${group.id}" value="${dup.id}" ${index === 0 ? 'checked' : ''}>
                            <div class="item-info">
                                <div class="item-title">${escapeHtml(dup.title)}</div>
                                <div class="item-details">
                                    Album: ${escapeHtml(dup.album)} ‚Ä¢ Source: ${escapeHtml(dup.source)}
                                    <span class="quality-badge quality-${dup.quality.toLowerCase()}">${dup.quality} Quality</span>
                                </div>
                            </div>
                            <div class="item-actions">
                                <button class="keep-button" onclick="keepThis(${group.id}, '${dup.id}')">Keep</button>
                                <button class="remove-button" onclick="removeThis('${dup.id}')">Remove</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            return div;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function toggleGroup(groupId) {
            const group = document.querySelector(`[data-group-id="${groupId}"] .duplicates-list`);
            const isVisible = group.style.display !== 'none';
            group.style.display = isVisible ? 'none' : 'block';
            
            const arrow = document.querySelector(`[data-group-id="${groupId}"] .group-header div:last-child`);
            arrow.textContent = isVisible ? '‚ñº' : '‚ñ≤';
        }
        
        function toggleGroupSelection(groupId) {
            const checkbox = document.querySelector(`[data-group-id="${groupId}"] .group-checkbox`);
            const groupElement = document.querySelector(`[data-group-id="${groupId}"]`);
            
            if (checkbox.checked) {
                selectedGroups.add(groupId);
                groupElement.classList.add('selected');
            } else {
                selectedGroups.delete(groupId);
                groupElement.classList.remove('selected');
            }
            
            // Enable/disable create selected button
            document.getElementById('createSelectedButton').disabled = selectedGroups.size === 0;
        }
        
        function selectAllGroups() {
            duplicateGroups.forEach(group => {
                const checkbox = document.querySelector(`[data-group-id="${group.id}"] .group-checkbox`);
                const groupElement = document.querySelector(`[data-group-id="${group.id}"]`);
                
                checkbox.checked = true;
                selectedGroups.add(group.id);
                groupElement.classList.add('selected');
            });
            
            document.getElementById('createSelectedButton').disabled = false;
        }
        
        function keepThis(groupId, dupId) {
            const radio = document.querySelector(`input[name="keep-${groupId}"][value="${dupId}"]`);
            radio.checked = true;
            log(`‚úÖ Marked "${dupId}" as the version to keep for group ${groupId}`);
        }
        
        function removeThis(dupId) {
            log(`üóëÔ∏è Marked "${dupId}" for removal`);
        }
        
        async function createDuplicatesPlaylist() {
            if (duplicateGroups.length === 0) {
                showError('No duplicates found to create playlist from');
                return;
            }
            
            log('üéµ Creating "True Duplicates" playlist...');
            
            try {
                const response = await fetch(`${API_BASE}/create-playlist`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: 'üóÇÔ∏è True Duplicates',
                        type: 'all'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    log('‚úÖ Playlist created successfully!');
                    log(`üéµ Playlist URL: ${data.playlist_url}`);
                    log(`üìù Added ${data.songs_added} songs to playlist`);
                    showSuccess(`Playlist created! Added ${data.songs_added} songs. Check your YouTube Music library.`);
                } else {
                    throw new Error(data.error);
                }
                
            } catch (error) {
                log('‚ùå Failed to create playlist: ' + error.message);
                showError('Failed to create playlist: ' + error.message);
            }
        }
        
        async function createSelectedPlaylist() {
            if (selectedGroups.size === 0) {
                showError('Please select at least one duplicate group!');
                return;
            }
            
            log(`üéµ Creating playlist with ${selectedGroups.size} selected groups...`);
            
            try {
                const response = await fetch(`${API_BASE}/create-playlist`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: 'üóÇÔ∏è Selected Duplicates',
                        type: 'selected',
                        selected_groups: Array.from(selectedGroups)
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    log('‚úÖ Selected duplicates playlist created!');
                    log(`üéµ Playlist URL: ${data.playlist_url}`);
                    showSuccess(`Playlist created with ${data.songs_added} songs from ${selectedGroups.size} groups!`);
                } else {
                    throw new Error(data.error);
                }
                
            } catch (error) {
                log('‚ùå Failed to create playlist: ' + error.message);
                showError('Failed to create playlist: ' + error.message);
            }
        }
        
        async function exportResults() {
            try {
                const response = await fetch(`${API_BASE}/export`);
                const data = await response.json();
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `youtube_music_duplicates_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                
                log('üìÑ Results exported successfully');
                showSuccess('Results exported to downloads folder');
                
            } catch (error) {
                log('‚ùå Export failed: ' + error.message);
                showError('Failed to export results: ' + error.message);
            }
        }
        
        function updateProgress(percent) {
            document.getElementById('progressFill').style.width = percent + '%';
        }
        
        function log(message) {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            logArea.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        function showError(message) {
            removeMessages();
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            document.querySelector('.controls').appendChild(errorDiv);
            
            setTimeout(() => {
                if (errorDiv.parentNode) {
                    errorDiv.parentNode.removeChild(errorDiv);
                }
            }, 10000);
        }
        
        function showSuccess(message) {
            removeMessages();
            const successDiv = document.createElement('div');
            successDiv.className = 'success-message';
            successDiv.textContent = message;
            document.querySelector('.controls').appendChild(successDiv);
            
            setTimeout(() => {
                if (successDiv.parentNode) {
                    successDiv.parentNode.removeChild(successDiv);
                }
            }, 8000);
        }
        
        function removeMessages() {
            const messages = document.querySelectorAll('.error-message, .success-message');
            messages.forEach(msg => {
                if (msg.parentNode) {
                    msg.parentNode.removeChild(msg);
                }
            });
        }
    </script>
</body>
</html>